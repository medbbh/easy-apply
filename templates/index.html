<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1a202c;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            color: #718096;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 12px;
            background: white;
            padding: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .tab:not(.active) {
            color: #718096;
        }
        
        .tab:hover:not(.active) {
            background: #f7fafc;
            color: #4a5568;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .dynamic-list {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }
        
        .list-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 8px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .search-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 40px;
        }
        
        .keywords-input {
            margin-bottom: 20px;
        }
        
        .keywords-input input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }
        
        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results-section {
            display: none;
        }
        
        .results-section.active {
            display: block;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .results-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .job-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .job-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .job-company {
            font-size: 1rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .job-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            color: #718096;
        }
        
        .job-description {
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .job-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            transition: transform 0.2s;
            border: none;
            cursor: pointer;
        }
        
        .btn-sm:hover {
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .tag {
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .tag.visa {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .tag.remote {
            background: #bee3f8;
            color: #2c5282;
        }
        
        /* PDF Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            height: 90%;
            max-width: 900px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            padding: 5px;
        }

        .modal-body {
            flex: 1;
            padding: 0;
            overflow: hidden;
        }

        .pdf-viewer {
            width: 100%;
            height: 100%;
            border: none;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .job-actions {
                flex-direction: column;
            }
            
            .btn-sm {
                text-align: center;
            }

            .modal-content {
                width: 95%;
                height: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Job Application Bot</h1>
            <p>Personalized resumes and cover letters for every job application</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('profile')">👤 My Profile</div>
            <div class="tab" onclick="showTab('search')">🔍 Job Search</div>
        </div>

        <!-- Profile Tab -->
        <div id="profile-tab" class="tab-content active">
            <div class="section">
                <div class="section-title">Personal Information</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" placeholder="M'hamed">
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" placeholder="Babah">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="mhamed.bbh01@gmail.com">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" placeholder="+222 34503710">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" placeholder="Nouakchott, Mauritania">
                    </div>
                    <div class="form-group">
                        <label for="linkedin">LinkedIn</label>
                        <input type="text" id="linkedin" placeholder="linkedin.com/in/mhamed-elbah-6a954b211">
                    </div>
                </div>
                <div class="form-group">
                    <label for="github">GitHub</label>
                    <input type="text" id="github" placeholder="github.com/medbbh">
                </div>
                <div class="form-group">
                    <label for="professionalSummary">Professional Summary</label>
                    <textarea id="professionalSummary" placeholder="Full Stack Developer with expertise in building secure, data-intensive applications..."></textarea>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Education</div>
                <div class="dynamic-list" id="education-list">
                    <!-- Education items will be added here -->
                </div>
                <button class="add-btn" onclick="addEducation()">+ Add Education</button>
            </div>

            <div class="section">
                <div class="section-title">Experience</div>
                <div class="dynamic-list" id="experience-list">
                    <!-- Experience items will be added here -->
                </div>
                <button class="add-btn" onclick="addExperience()">+ Add Experience</button>
            </div>

            <div class="section">
                <div class="section-title">Projects</div>
                <div class="dynamic-list" id="projects-list">
                    <!-- Project items will be added here -->
                </div>
                <button class="add-btn" onclick="addProject()">+ Add Project</button>
            </div>

            <div class="section">
                <div class="section-title">Technical Skills</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="languages">Programming Languages</label>
                        <input type="text" id="languages" placeholder="Python, JavaScript, Java, SQL">
                    </div>
                    <div class="form-group">
                        <label for="frameworks">Frameworks</label>
                        <input type="text" id="frameworks" placeholder="React, Django, Angular, Node.js">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="databases">Databases</label>
                        <input type="text" id="databases" placeholder="PostgreSQL, MySQL, MongoDB">
                    </div>
                    <div class="form-group">
                        <label for="tools">Tools & Technologies</label>
                        <input type="text" id="tools" placeholder="Git, Docker, AWS, Linux">
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Certifications</div>
                <div class="dynamic-list" id="certifications-list">
                    <!-- Certification items will be added here -->
                </div>
                <button class="add-btn" onclick="addCertification()">+ Add Certification</button>
            </div>

            <div class="profile-actions">
                <button class="btn btn-primary" onclick="saveProfile()">💾 Save Profile</button>
                <button class="btn btn-secondary" onclick="loadProfile()">📂 Load Profile</button>
                <button class="btn btn-secondary" onclick="clearProfile()">🗑️ Clear All</button>
            </div>
        </div>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content">
            <div class="search-section">
                <div class="keywords-input">
                    <label for="keywords">Keywords (separate with commas)</label>
                    <input 
                        type="text" 
                        id="keywords" 
                        placeholder="remote, visa sponsorship, python developer, javascript, react..."
                        value="remote, visa sponsorship, python developer"
                    >
                </div>
                <button class="search-btn" onclick="searchJobs()">
                    🔍 Search Jobs & Generate Personalized Applications
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <h3>Searching jobs and generating personalized applications...</h3>
                <p>Using your profile to create custom resumes and cover letters</p>
            </div>

            <div class="results-section" id="results-section">
                <div class="results-header">
                    <h2>Job Results</h2>
                    <span class="results-count" id="results-count">0 jobs found</span>
                </div>
                <div id="jobs-list"></div>
            </div>
        </div>
    </div>

    <!-- PDF Modal -->
    <div class="modal" id="pdf-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Document Preview</h3>
                <button class="modal-close" onclick="closePdfModal()">&times;</button>
            </div>
            <div class="modal-body">
                <iframe class="pdf-viewer" id="pdf-viewer" src=""></iframe>
            </div>
            <div class="modal-footer">
                <button class="btn-sm btn-success" onclick="downloadCurrentPdf()">
                    📥 Download PDF
                </button>
                <button class="btn-sm btn-outline" onclick="closePdfModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        let searchInterval;
        let currentDownloadUrl = '';
        let educationCounter = 0;
        let experienceCounter = 0;
        let projectCounter = 0;
        let certificationCounter = 0;

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Dynamic List Management
        function addEducation() {
            const container = document.getElementById('education-list');
            const id = ++educationCounter;
            const html = `
                <div class="list-item" id="edu-${id}">
                    <button class="remove-btn" onclick="removeItem('edu-${id}')">×</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Degree</label>
                            <input type="text" placeholder="Master in Information Systems">
                        </div>
                        <div class="form-group">
                            <label>Institution</label>
                            <input type="text" placeholder="University of Nouakchott">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Period</label>
                        <input type="text" placeholder="Oct 2023 - Present">
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        function addExperience() {
            const container = document.getElementById('experience-list');
            const id = ++experienceCounter;
            const html = `
                <div class="list-item" id="exp-${id}">
                    <button class="remove-btn" onclick="removeItem('exp-${id}')">×</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Job Title</label>
                            <input type="text" placeholder="Software Developer Intern">
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" placeholder="Next Technology">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Period</label>
                        <input type="text" placeholder="Jul 2023 - Present">
                    </div>
                    <div class="form-group">
                        <label>Technologies</label>
                        <input type="text" placeholder="Django REST, React, PostgreSQL">
                    </div>
                    <div class="form-group">
                        <label>Responsibilities (one per line)</label>
                        <textarea placeholder="Developed REST APIs for e-commerce platform&#10;Integrated Stripe payment processing&#10;Implemented JWT authentication"></textarea>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        function addProject() {
            const container = document.getElementById('projects-list');
            const id = ++projectCounter;
            const html = `
                <div class="list-item" id="proj-${id}">
                    <button class="remove-btn" onclick="removeItem('proj-${id}')">×</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Project Title</label>
                            <input type="text" placeholder="Thimar - AI Productivity Platform">
                        </div>
                        <div class="form-group">
                            <label>Achievement/Award</label>
                            <input type="text" placeholder="Winner, Supabase Launch Week 14">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Technologies</label>
                        <input type="text" placeholder="React, Supabase, PostgreSQL, AI">
                    </div>
                    <div class="form-group">
                        <label>Description (one feature per line)</label>
                        <textarea placeholder="Built task management platform with prayer-time scheduling&#10;Implemented real-time data sync using Supabase&#10;Developed habit-tracking visualizations"></textarea>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        function addCertification() {
            const container = document.getElementById('certifications-list');
            const id = ++certificationCounter;
            const html = `
                <div class="list-item" id="cert-${id}">
                    <button class="remove-btn" onclick="removeItem('cert-${id}')">×</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Certification Name</label>
                            <input type="text" placeholder="Flutter Bootcamp">
                        </div>
                        <div class="form-group">
                            <label>Issuer</label>
                            <input type="text" placeholder="Smart MS SA">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="text" placeholder="Dec 2023">
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        function removeItem(id) {
            document.getElementById(id).remove();
        }

        // Profile Management
        function saveProfile() {
            const profile = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                location: document.getElementById('location').value,
                linkedin: document.getElementById('linkedin').value,
                github: document.getElementById('github').value,
                professionalSummary: document.getElementById('professionalSummary').value,
                education: getListData('education-list'),
                experiences: getListData('experience-list'),
                projects: getListData('projects-list'),
                certifications: getListData('certifications-list'),
                skills: {
                    languages: document.getElementById('languages').value.split(',').map(s => s.trim()).filter(s => s),
                    frameworks: document.getElementById('frameworks').value.split(',').map(s => s.trim()).filter(s => s),
                    databases: document.getElementById('databases').value.split(',').map(s => s.trim()).filter(s => s),
                    tools: document.getElementById('tools').value.split(',').map(s => s.trim()).filter(s => s)
                }
            };

            localStorage.setItem('userProfile', JSON.stringify(profile));
            alert('✅ Profile saved successfully!');
        }

        function loadProfile() {
            const saved = localStorage.getItem('userProfile');
            if (!saved) {
                alert('No saved profile found!');
                return;
            }

            const profile = JSON.parse(saved);
            
            // Load basic info
            document.getElementById('firstName').value = profile.firstName || '';
            document.getElementById('lastName').value = profile.lastName || '';
            document.getElementById('email').value = profile.email || '';
            document.getElementById('phone').value = profile.phone || '';
            document.getElementById('location').value = profile.location || '';
            document.getElementById('linkedin').value = profile.linkedin || '';
            document.getElementById('github').value = profile.github || '';
            document.getElementById('professionalSummary').value = profile.professionalSummary || '';

            // Load skills
            if (profile.skills) {
                document.getElementById('languages').value = profile.skills.languages ? profile.skills.languages.join(', ') : '';
                document.getElementById('frameworks').value = profile.skills.frameworks ? profile.skills.frameworks.join(', ') : '';
                document.getElementById('databases').value = profile.skills.databases ? profile.skills.databases.join(', ') : '';
                document.getElementById('tools').value = profile.skills.tools ? profile.skills.tools.join(', ') : '';
            }

            // Load lists
            loadListData('education-list', profile.education || [], addEducation);
            loadListData('experience-list', profile.experiences || [], addExperience);
            loadListData('projects-list', profile.projects || [], addProject);
            loadListData('certifications-list', profile.certifications || [], addCertification);

            alert('✅ Profile loaded successfully!');
        }

        function clearProfile() {
            if (confirm('Are you sure you want to clear all profile data?')) {
                localStorage.removeItem('userProfile');
                location.reload();
            }
        }

        function getListData(containerId) {
            const container = document.getElementById(containerId);
            const items = container.querySelectorAll('.list-item');
            const data = [];

            items.forEach(item => {
                const inputs = item.querySelectorAll('input, textarea');
                const itemData = {};
                
                inputs.forEach(input => {
                    const label = input.previousElementSibling.textContent.toLowerCase().replace(/\s+/g, '');
                    if (input.tagName === 'TEXTAREA' && label === 'responsibilities') {
                        itemData[label] = input.value.split('\n').filter(line => line.trim());
                    } else if (input.tagName === 'TEXTAREA' && label === 'description') {
                        itemData[label] = input.value.split('\n').filter(line => line.trim());
                    } else {
                        itemData[label] = input.value;
                    }
                });
                
                if (Object.values(itemData).some(val => val && val.length > 0)) {
                    data.push(itemData);
                }
            });

            return data;
        }

        function loadListData(containerId, data, addFunction) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            data.forEach(item => {
                addFunction();
                const lastItem = container.lastElementChild;
                const inputs = lastItem.querySelectorAll('input, textarea');
                
                inputs.forEach(input => {
                    const label = input.previousElementSibling.textContent.toLowerCase().replace(/\s+/g, '');
                    if (item[label]) {
                        if (Array.isArray(item[label])) {
                            input.value = item[label].join('\n');
                        } else {
                            input.value = item[label];
                        }
                    }
                });
            });
        }

        // Job Search Functions
        function searchJobs() {
            const keywords = document.getElementById('keywords').value.trim();
            
            if (!keywords) {
                alert('Please enter some keywords');
                return;
            }

            // Get user profile
            const savedProfile = localStorage.getItem('userProfile');
            const userProfile = savedProfile ? JSON.parse(savedProfile) : null;

            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results-section').classList.remove('active');
            document.querySelector('.search-btn').disabled = true;

            // Start search
            const keywordArray = keywords.split(',').map(k => k.trim()).filter(k => k);
            
            fetch('/api/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    keywords: keywordArray,
                    userProfile: userProfile
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'started') {
                    searchInterval = setInterval(checkStatus, 2000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
                alert('Error starting job search');
            });
        }

        function checkStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    if (!data.is_searching) {
                        clearInterval(searchInterval);
                        hideLoading();
                        showResults(data.results);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    clearInterval(searchInterval);
                    hideLoading();
                });
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
            document.querySelector('.search-btn').disabled = false;
        }

        function showResults(results) {
            const resultsSection = document.getElementById('results-section');
            const jobsList = document.getElementById('jobs-list');
            const resultsCount = document.getElementById('results-count');

            resultsCount.textContent = `${results.length} jobs found`;

            if (results.length === 0) {
                jobsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">😔</div>
                        <h3>No jobs found</h3>
                        <p>Try different keywords or check back later</p>
                    </div>
                `;
            } else {
                jobsList.innerHTML = results.map(job => `
                    <div class="job-card">
                        <div class="job-title">${job.title}</div>
                        <div class="job-company">${job.company}</div>
                        <div class="job-meta">
                            <span>📍 ${job.location}</span>
                            <span>💰 ${job.salary || 'Competitive'}</span>
                            <span>🏷️ ${job.source}</span>
                        </div>
                        <div class="job-meta">
                            ${job.visa_sponsorship ? '<span class="tag visa">✅ Visa Friendly</span>' : ''}
                            ${job.remote_work ? '<span class="tag remote">🏠 Remote</span>' : ''}
                            <span class="tag">${job.experience_level}</span>
                            <span class="tag">${job.tech_stack}</span>
                        </div>
                        <div class="job-description">${job.description}</div>
                        <div class="job-actions">
                            <a href="${job.url}" target="_blank" class="btn-sm btn-primary">
                                🔗 View Job
                            </a>
                            <button class="btn-sm btn-success" onclick="viewPdf('resume', '${job.folder}', '${job.company} - Resume')">
                                👁️ View Resume PDF
                            </button>
                            <button class="btn-sm btn-success" onclick="viewPdf('cover-letter', '${job.folder}', '${job.company} - Cover Letter')">
                                👁️ View Cover Letter PDF
                            </button>
                            <a href="/download/resume/${job.folder}" class="btn-sm btn-outline">
                                📄 Download Resume
                            </a>
                            <a href="/download/cover-letter/${job.folder}" class="btn-sm btn-outline">
                                📝 Download Cover Letter
                            </a>
                            <a href="/download/job-info/${job.folder}" class="btn-sm btn-outline">
                                📋 Job Info
                            </a>
                        </div>
                    </div>
                `).join('');
            }

            resultsSection.classList.add('active');
        }

        // PDF Modal Functions
        function viewPdf(type, folder, title) {
            const modal = document.getElementById('pdf-modal');
            const viewer = document.getElementById('pdf-viewer');
            const modalTitle = document.getElementById('modal-title');
            
            const viewUrl = `/view/${type}/${folder}`;
            currentDownloadUrl = `/download/${type}/${folder}`;
            
            modalTitle.textContent = title;
            viewer.src = viewUrl;
            modal.classList.add('active');
        }

        function closePdfModal() {
            const modal = document.getElementById('pdf-modal');
            const viewer = document.getElementById('pdf-viewer');
            
            modal.classList.remove('active');
            viewer.src = '';
            currentDownloadUrl = '';
        }

        function downloadCurrentPdf() {
            if (currentDownloadUrl) {
                window.location.href = currentDownloadUrl;
            }
        }

        // Event Listeners
        document.getElementById('pdf-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePdfModal();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePdfModal();
            }
        });

        document.getElementById('keywords').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchJobs();
            }
        });

        // Auto-load profile on page load
        window.addEventListener('load', function() {
            const saved = localStorage.getItem('userProfile');
            if (saved) {
                loadProfile();
            }
        });
    </script>
</body>
</html>