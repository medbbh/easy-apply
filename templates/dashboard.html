<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Bot Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px); 
            padding: 25px; 
            border-radius: 15px; 
            margin-bottom: 30px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
        }
        .header h1 { color: #4a5568; margin-bottom: 10px; font-size: 2.2em; }
        .header p { color: #718096; font-size: 1.1em; }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px); 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            transition: transform 0.3s ease; 
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-value { font-size: 2.5em; font-weight: bold; color: #2563eb; margin-bottom: 5px; }
        .stat-label { color: #6b7280; font-weight: 500; }
        .controls { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px); 
            padding: 25px; 
            border-radius: 15px; 
            margin-bottom: 30px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
        }
        .controls h3 { color: #4a5568; margin-bottom: 20px; font-size: 1.3em; }
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 5px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .btn-success { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        .btn-danger { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); }
        .input-group { margin: 15px 0; }
        .input-group label { display: block; margin-bottom: 5px; color: #4a5568; font-weight: 500; }
        .input-group input { 
            padding: 10px; 
            border: 2px solid #e2e8f0; 
            border-radius: 6px; 
            font-size: 14px; 
            width: 100px; 
        }
        .input-group input:focus { outline: none; border-color: #667eea; }
        .status-message { margin-top: 15px; padding: 10px; border-radius: 6px; display: none; }
        .status-success { background: #f0fff4; color: #22543d; border: 1px solid #68d391; }
        .status-error { background: #fed7d7; color: #742a2a; border: 1px solid #fc8181; }
        .tabs { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px); 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
        }
        .tab-headers { 
            display: flex; 
            border-bottom: 1px solid #e5e7eb; 
            border-radius: 15px 15px 0 0; 
            overflow: hidden; 
        }
        .tab-header { 
            flex: 1; 
            padding: 20px; 
            cursor: pointer; 
            background: transparent; 
            border: none; 
            font-weight: 600; 
            color: #6b7280; 
            transition: all 0.3s ease; 
        }
        .tab-header.active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
        }
        .tab-content { padding: 30px; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        .job-item { 
            border: 1px solid #e5e7eb; 
            border-radius: 10px; 
            padding: 20px; 
            margin-bottom: 15px; 
            background: #fafafa; 
            transition: all 0.3s ease; 
        }
        .job-item:hover { background: #f7fafc; border-color: #cbd5e0; }
        .job-title { font-weight: bold; color: #2d3748; font-size: 1.1em; margin-bottom: 5px; }
        .job-company { color: #4a5568; font-weight: 500; margin-bottom: 8px; }
        .job-meta { 
            font-size: 0.9em; 
            color: #718096; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
        }
        .meta-item { display: flex; align-items: center; gap: 5px; }
        .status { padding: 4px 12px; border-radius: 15px; font-size: 0.8em; font-weight: 600; }
        .status-applied { background: #bee3f8; color: #2b6cb0; }
        .status-interview { background: #c6f6d5; color: #2f855a; }
        .status-rejected { background: #fed7d7; color: #c53030; }
        .status-test { background: #fbd38d; color: #c05621; }
        .empty-state { text-align: center; padding: 40px; color: #a0aec0; }
        .empty-state-icon { font-size: 3em; margin-bottom: 15px; }
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .tab-headers { flex-direction: column; }
            .job-meta { flex-direction: column; gap: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Job Application Bot Dashboard</h1>
            <p>Monitor and control your automated job search</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="jobs-scanned">-</div>
                <div class="stat-label">Jobs Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="applications-sent">-</div>
                <div class="stat-label">Applications Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="success-rate">-</div>
                <div class="stat-label">Success Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-applications">-</div>
                <div class="stat-label">Total Applications</div>
            </div>
        </div>

        <div class="controls">
            <h3>üéõÔ∏è Bot Controls</h3>
            <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">
                <button class="btn" onclick="runBot(true)">üß™ Test Run</button>
                <button class="btn btn-success" onclick="runBot(false)">‚ñ∂Ô∏è Live Run</button>
                
                <div class="input-group" style="margin: 0;">
                    <label for="max-apps">Max Apps:</label>
                    <input type="number" id="max-apps" value="3" min="1" max="15">
                </div>
            </div>
            
            <div id="status-message" class="status-message"></div>
        </div>

        <div class="tabs">
            <div class="tab-headers">
                <button class="tab-header active" onclick="showTab('jobs', this)">üîç Recent Jobs</button>
                <button class="tab-header" onclick="showTab('applications', this)">üìã Applications</button>
                <button class="tab-header" onclick="showTab('files', this)">üìÅ Generated Files</button>
                <button class="tab-header" onclick="showTab('system', this)">‚öôÔ∏è System Info</button>
            </div>
            
            <div class="tab-content">
                <div class="tab-pane active" id="jobs-tab">
                    <h3 style="margin-bottom: 20px; color: #4a5568;">Recently Found Jobs</h3>
                    <div id="jobs-list">Loading...</div>
                </div>
                
                <div class="tab-pane" id="applications-tab">
                    <h3 style="margin-bottom: 20px; color: #4a5568;">Application History</h3>
                    <div id="applications-list">Loading...</div>
                </div>
                
                <div class="tab-pane" id="files-tab">
                    <h3 style="margin-bottom: 20px; color: #4a5568;">Generated Resume Files</h3>
                    <div id="files-list">Loading...</div>
                </div>
                
                <div class="tab-pane" id="system-tab">
                    <h3 style="margin-bottom: 20px; color: #4a5568;">System Information</h3>
                    <div id="system-info">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let refreshInterval;

        window.onload = function() {
            loadAllData();
            refreshInterval = setInterval(loadAllData, 30000);
        };

        function loadAllData() {
            loadStats();
            loadJobs();
            loadApplications();
            loadFiles();
            loadSystemInfo();
        }

        function loadStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('jobs-scanned').textContent = data.jobs_scanned_today || data.total_jobs || 0;
                    document.getElementById('applications-sent').textContent = data.applications_today || 0;
                    document.getElementById('success-rate').textContent = (data.success_rate || 0) + '%';
                    document.getElementById('total-applications').textContent = data.total_applications || 0;
                })
                .catch(error => {
                    console.error('Error loading stats:', error);
                    document.getElementById('jobs-scanned').textContent = '?';
                });
        }

        function loadJobs() {
            fetch('/api/jobs')
                .then(response => response.json())
                .then(jobs => {
                    const jobsList = document.getElementById('jobs-list');
                    
                    if (jobs.length === 0) {
                        jobsList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üîç</div>
                                <div>No jobs found yet</div>
                                <div style="margin-top: 10px; font-size: 0.9em;">Run the bot to start finding jobs!</div>
                            </div>
                        `;
                        return;
                    }
                    
                    jobsList.innerHTML = jobs.map(job => `
                        <div class="job-item">
                            <div class="job-title">${job.title}</div>
                            <div class="job-company">${job.company}</div>
                            <div class="job-meta">
                                <span class="meta-item">üìç ${job.location}</span>
                                <span class="meta-item">üìÖ ${new Date(job.posted_date).toLocaleDateString()}</span>
                                <span class="meta-item">üè∑Ô∏è ${job.source}</span>
                                <span class="meta-item">${job.visa_sponsorship ? '‚úÖ Visa Friendly' : '‚ùì Visa Unknown'}</span>
                                ${job.salary ? `<span class="meta-item">üí∞ ${job.salary}</span>` : ''}
                            </div>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error loading jobs:', error);
                    document.getElementById('jobs-list').innerHTML = '<div class="job-item">Error loading jobs</div>';
                });
        }

        function loadApplications() {
            fetch('/api/applications')
                .then(response => response.json())
                .then(applications => {
                    const appsList = document.getElementById('applications-list');
                    
                    if (applications.length === 0) {
                        appsList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <div>No applications sent yet</div>
                                <div style="margin-top: 10px; font-size: 0.9em;">Run the bot to start applying!</div>
                            </div>
                        `;
                        return;
                    }
                    
                    appsList.innerHTML = applications.map(app => `
                        <div class="job-item">
                            <div class="job-title">${app.title}</div>
                            <div class="job-company">${app.company}</div>
                            <div class="job-meta">
                                <span class="meta-item">üìÖ ${new Date(app.application_date).toLocaleDateString()}</span>
                                <span class="status status-${app.status}">${app.status}</span>
                                <span class="meta-item">üìÑ ${app.resume_file}</span>
                            </div>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error loading applications:', error);
                    document.getElementById('applications-list').innerHTML = '<div class="job-item">Error loading applications</div>';
                });
        }

        function loadFiles() {
            fetch('/api/files')
                .then(response => response.json())
                .then(files => {
                    const filesList = document.getElementById('files-list');
                    
                    if (files.length === 0) {
                        filesList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üìÅ</div>
                                <div>No resume files generated yet</div>
                                <div style="margin-top: 10px; font-size: 0.9em;">Files will appear here after running the bot</div>
                            </div>
                        `;
                        return;
                    }
                    
                    filesList.innerHTML = files.map(file => `
                        <div class="job-item">
                            <div class="job-title">üìÑ ${file.filename}</div>
                            <div class="job-meta">
                                <span class="meta-item">üìè ${file.size}</span>
                                <span class="meta-item">üìÖ ${new Date(file.created).toLocaleDateString()}</span>
                                <span class="meta-item">üïí ${new Date(file.created).toLocaleTimeString()}</span>
                            </div>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error loading files:', error);
                    document.getElementById('files-list').innerHTML = '<div class="job-item">Error loading files</div>';
                });
        }

        function loadSystemInfo() {
            fetch('/api/bot-status')
                .then(response => response.json())
                .then(info => {
                    const systemInfo = document.getElementById('system-info');
                    systemInfo.innerHTML = `
                        <div class="job-item">
                            <div class="job-title">üíæ Database Status</div>
                            <div class="job-meta">
                                <span class="meta-item">${info.database_exists ? '‚úÖ Connected' : '‚ùå Not Found'}</span>
                                <span class="meta-item">üìç ${info.database_path}</span>
                            </div>
                        </div>
                        <div class="job-item">
                            <div class="job-title">üìÅ Generated Files</div>
                            <div class="job-meta">
                                <span class="meta-item">üìÑ ${info.resume_files} resume files</span>
                            </div>
                        </div>
                        <div class="job-item">
                            <div class="job-title">üïí Last Updated</div>
                            <div class="job-meta">
                                <span class="meta-item">${new Date(info.last_updated).toLocaleString()}</span>
                            </div>
                        </div>
                    `;
                })
                .catch(error => {
                    console.error('Error loading system info:', error);
                    document.getElementById('system-info').innerHTML = '<div class="job-item">Error loading system info</div>';
                });
        }

        function runBot(dryRun) {
            const maxApps = document.getElementById('max-apps').value;
            const statusDiv = document.getElementById('status-message');
            
            statusDiv.className = 'status-message status-success';
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = `ü§ñ Starting bot... (${dryRun ? 'Test mode' : 'Live mode'})`;
            
            fetch('/api/run-bot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dry_run: dryRun,
                    max_apps: parseInt(maxApps)
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    statusDiv.className = 'status-message status-success';
                    statusDiv.innerHTML = `‚úÖ ${data.message} (${data.mode}, max: ${data.max_apps} apps)`;
                    
                    setTimeout(() => {
                        loadAllData();
                        statusDiv.innerHTML += '<br>üìä Data refreshed automatically';
                    }, 10000);
                    
                    setTimeout(() => {
                        statusDiv.style.display = 'none';
                    }, 30000);
                } else {
                    statusDiv.className = 'status-message status-error';
                    statusDiv.innerHTML = '‚ùå Error: ' + data.message;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                statusDiv.className = 'status-message status-error';
                statusDiv.innerHTML = '‚ùå Error starting bot. Check console for details.';
            });
        }

        function showTab(tabName, element) {
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.querySelectorAll('.tab-header').forEach(header => {
                header.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            element.classList.add('active');
        }

        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                clearInterval(refreshInterval);
            } else {
                refreshInterval = setInterval(loadAllData, 30000);
                loadAllData();
            }
        });
    </script>
</body>
</html>